# Olend DeFi 借贷平台实现计划

- [x] 1. 建立项目结构和核心接口






  - 创建 Move 包结构，包含 liquidity、lending、borrowing、account、oracle、liquidator 模块
  - 定义所有模块间的接口和依赖关系
  - 实现错误码定义模块
  - _需求: 1.1, 1.2, 1.3_

- [ ] 2. 实现 Liquidity 模块核心功能
  - [x] 2.1 实现 AdminCap 和 Registry 数据结构



    - 编写 AdminCap 结构体和创建函数
    - 实现 Registry 全局注册表和初始化逻辑
    - 创建单元测试验证权限控制机制
    - _需求: 1.1, 1.2, 1.13_

  - [ ] 2.2 实现 Vault 核心数据结构和基础操作
    - 编写 Vault<T> 结构体定义
    - 实现 create_vault 函数和 ERC-4626 兼容性
    - 实现基础的 deposit、withdraw、borrow、repay 函数
    - 创建份额计算和汇率更新逻辑
    - _需求: 1.4, 1.5, 1.6, 1.14_

  - [ ] 2.3 实现 Vault 管理和控制功能
    - 实现暂停/恢复机制 (pause_vault, resume_vault)
    - 实现每日限额控制逻辑和重置机制
    - 实现紧急暂停和时间锁机制
    - 编写管理操作的事件日志记录
    - _需求: 1.7, 1.8, 1.9, 1.10, 1.11, 1.12, 1.15, 1.17, 1.18_

- [ ] 3. 实现 Oracle 价格服务模块
  - [ ] 3.1 实现基础价格数据结构
    - 编写 PriceData 和 PriceAggregator 结构体
    - 实现与 Pyth Network 的集成接口
    - 创建价格验证和置信度检查逻辑
    - _需求: 4.1, 4.2, 4.3_

  - [ ] 3.2 实现价格聚合和异常处理
    - 实现 TWAP (时间加权平均价格) 计算
    - 实现多源价格聚合和中位数计算
    - 实现价格偏差检测和异常处理机制
    - 实现价格缓存和备用数据源切换
    - _需求: 4.4, 4.5, 4.6, 4.8, 4.9, 4.10, 4.13_

- [ ] 4. 实现 Account 用户账户管理模块
  - [ ] 4.1 实现账户注册和权限系统
    - 编写 AccountRegistry 和 Account 数据结构
    - 实现 AccountCap 权限凭证和验证逻辑
    - 实现用户账户创建和初始化流程
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

  - [ ] 4.2 实现用户等级和积分系统
    - 实现 UserLevel 和 TierBenefits 结构体
    - 编写积分累积和等级升级逻辑
    - 实现等级权益计算和应用机制
    - 创建用户活跃度跟踪和休眠机制
    - _需求: 5.6, 5.7, 5.8, 5.13, 5.14, 5.15, 5.17_

- [ ] 5. 实现 Lending 存款借贷模块
  - [ ] 5.1 实现 LendingPool 和利息模型
    - 编写 LendingPool 和 InterestRateModel 结构体
    - 实现动态利率计算和更新机制
    - 实现复利计算和利息指数更新
    - _需求: 2.5, 2.6_

  - [ ] 5.2 实现 YToken 份额凭证系统
    - 编写 YToken 结构体和铸造/销毁逻辑
    - 实现份额与资产的汇率计算
    - 实现存款和取款的核心业务逻辑
    - 集成 Vault 操作和账户更新
    - _需求: 2.1, 2.2, 2.3, 2.4_

  - [ ] 5.3 实现存款限制和保护机制
    - 实现最小存款/取款金额验证
    - 实现存款上限和大额操作延迟机制
    - 实现抵押状态检查和取款限制
    - 实现异常保护和利息分配逻辑
    - _需求: 2.9, 2.10, 2.11, 2.12, 2.13, 2.14, 2.15, 2.7_

- [ ] 6. 实现 Borrowing 借款和抵押模块
  - [ ] 6.1 实现 BorrowingPool 和风险参数
    - 编写 BorrowingPool 结构体和配置参数
    - 实现抵押率和清算阈值设置
    - 实现动态/固定利率和期限配置
    - _需求: 3.1, 3.5, 3.6, 3.7, 3.8, 3.12_

  - [ ] 6.2 实现 Position 借款头寸管理
    - 编写 Position 结构体和创建逻辑
    - 实现抵押物价值计算和借款限额验证
    - 实现头寸健康度和 LTV 比率计算
    - 实现头寸按抵押率分组管理
    - _需求: 3.2, 3.3, 3.4, 3.13, 3.16, 3.17, 3.18_

  - [ ] 6.3 实现借款和还款业务逻辑
    - 实现借款创建和抵押物锁定逻辑
    - 实现还款处理和利息计算
    - 实现部分还款和抵押物释放机制
    - 实现借款限制和费用计算
    - _需求: 3.9, 3.10, 3.11, 3.14, 3.15, 3.19, 3.20, 3.21_

- [ ] 7. 实现 Liquidator 清算机制模块
  - [ ] 7.1 实现基础清算数据结构
    - 编写 LiquidationTick 和 LiquidationRecord 结构体
    - 实现 DexRouter 和多 DEX 支持配置
    - 实现清算条件检测和头寸标记逻辑
    - _需求: 6.2, 6.3, 6.18_

  - [ ] 7.2 实现批量清算和 Tick 机制
    - 实现基于 Tick 的批量清算算法
    - 实现阶梯式清算 (每次 10%) 逻辑
    - 实现清算优先级排序和风险评估
    - _需求: 6.2, 6.3, 6.5, 6.11_

  - [ ] 7.3 实现 DEX 集成和资产兑换
    - 集成 DEEPBook、Cetus、Bluefin DEX 接口
    - 实现最优路径选择和滑点控制
    - 实现清算奖励计算和分配机制
    - 实现 MEV 保护和随机延迟机制
    - _需求: 6.6, 6.7, 6.8, 6.12, 6.13, 6.16_

- [ ] 8. 实现平台治理和收益分配
  - [ ] 8.1 实现收益分配机制
    - 实现 10% 开发团队、10% 风险基金、80% 存款人的分配逻辑
    - 实现自动收益分配和风险基金管理
    - 实现分配比例的动态调整功能
    - _需求: 7.1, 7.2, 7.3, 7.8, 7.9_

  - [ ] 8.2 实现风险基金和紧急治理
    - 实现风险基金损失补偿机制
    - 实现紧急治理流程和参数调整
    - 实现平台持续运营和升级支持
    - _需求: 7.4, 7.5, 7.6, 7.7_

- [ ] 9. 实现安全和风险控制系统
  - [ ] 9.1 实现紧急暂停和风险参数管理
    - 实现全局紧急暂停功能
    - 实现动态风险参数调整机制
    - 实现大额操作安全检查和确认
    - _需求: 8.1, 8.2, 8.3, 8.6_

  - [ ] 9.2 实现异常检测和保护措施
    - 实现可疑活动检测和风险预警
    - 实现外部依赖失效的降级模式
    - 实现综合风险评估和监控系统
    - _需求: 8.4, 8.5, 8.7, 8.9, 8.10_

- [ ] 10. 实现用户体验和业务规则
  - [ ] 10.1 实现用户操作体验优化
    - 实现手续费预估和风险提示显示
    - 实现操作确认和撤销时间窗口
    - 实现差异化服务和激励机制
    - _需求: 9.1, 9.2, 9.3, 9.5, 9.6_

  - [ ] 10.2 实现用户支持和历史记录
    - 实现操作记录和收益统计查询
    - 实现错误处理和解决建议
    - 实现通知系统和客户支持
    - _需求: 9.7, 9.8, 9.9, 9.10, 9.11, 9.13_

- [ ] 11. 实现全面测试套件
  - [ ] 11.1 编写单元测试
    - 为所有核心模块编写单元测试
    - 测试边界条件和错误处理
    - 验证数学计算的准确性
    - _需求: 覆盖所有功能需求_

  - [ ] 11.2 编写集成测试
    - 测试模块间的交互和数据流
    - 测试完整的用户操作流程
    - 测试并发操作和竞态条件
    - _需求: 覆盖所有业务流程_

- [ ] 12. 部署和配置管理
  - [ ] 12.1 准备部署脚本和配置
    - 编写部署脚本和初始化配置
    - 配置预言机数据源和 DEX 集成
    - 设置初始风险参数和限额
    - _需求: 支持生产环境部署_

  - [ ] 12.2 实现监控和运维工具
    - 实现系统监控和告警机制
    - 创建运维工具和管理界面
    - 编写操作文档和故障排除指南
    - _需求: 支持平台稳定运行_